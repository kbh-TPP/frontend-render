## 前端渲染优化

### 一、目录

1、浏览器渲染原理

2、如何优化分层

3、网页动画

4、H5 Canvas的优化

### 二、页面是如何显示出来的？

![Alt text](/2-1.png)

先简单总体说下浏览器是如何显示一个页面的，要经过哪些步骤？
一个网页要显示出来需要经过加载、解析、排版和渲染几个过程。

加载：就是指从网上把页面资源都拉过来；

解析：就是分析html文件生成dom树；

排版：是开始计算各个节点的显示的位置坐标；

渲染：就是将dom树中各个节点都画出来最终呈现出网页的可视画面。之前跟一些前端同学打过交道，可能很多同学口中的网页渲染说的是页面元素该显示在什么位置或者什么样式。这其实大部分说的是页面排版的过程。

![Alt text](/2-2.png)

那么网页真正渲染的过程是这样的。主要涉及下面几个线程：render线程、合成线程以及光栅化线程。

不知道前端同学对线程是否了解。线程可以理解为：每个线程都是独立的执行任务，相互之间是异步的，能同时并发执行各自的任务。在来看这张图，renderer线程是内核运行的主线程，其中解析排版以及js执行都在这个线程，也只有这个线程能访问和操作dom树，所以只要跟dom树沾边的操作或任务就只能在这个线程中执行。

合成线程主要工作就是渲染显示。光栅化线程唯一任务就是光栅化了。

接着看流程：排版完成后页面各个元素的位置样式等都确定了。

接着开始录制。录制就是把页面的元素变成一条条绘制的指令。比如在xxx位置画xx图片，在xx位置显示一行文字等等。

录制完成后会将录制好的内容交给合成线程。合成线程会先把整个页面进行分块，一个页面分成若干个小的分块。在逐个将每个分块放到光栅化线程执行光栅化。

光栅化其实就是把之前录制好的指令真正地画成图像。光栅化完成后就形成了一个个分成块的网页的图像。

接着在合成线程根据当前屏幕大小和页面滑动的位置等，选择好要显示的分块，再把这些分块一个个滑到屏幕上。这样我们就看到了网页的显示画面了。

#### 2.1 网页分块渲染











